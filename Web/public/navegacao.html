<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="css/estilo.css">
    <link rel="stylesheet" href="css/navegacao.css">
    <script src="js/componentes.js"></script>
    <title>Navegar</title>
</head>
<body>
    <header id="header-placeholder"></header>
    <main>
        <section class="title__search">
            <div class="title__container">
                <h2>EXPLORE AS BANDAS</h2>
                <p>Navegue por todo o catálogo de bandas do Sempiternal</p>
            </div>
            <div class="input__box">
                <input type="text" id="input__search" placeholder="Buscar banda por nome..." oninput="ListarBandas()">
            </div>
        </section>
        <section id="band__list">
        </section>
    </main>
    <footer id="footer-placeholder"></footer>
    
    <script>
        CarregarHeader();
        CarregarFooter();
        ListarBandas()
        
        var bandList;
        
        function ListarBandas() {
            fetch(`/bandas/listarBandas`, {
                cache: 'no-store',
                headers: {
                    "Content-Type": "application/json"
                }
            }).then(function (resposta) {
                if (resposta.ok) {
                    resposta.json().then(json => {
                        bandList = json;
                        ExibirBandas();
                    });
                } else {
                    resposta.json().then(function (erro) {
                        MostrarFeedback(erro, false)
                    })
                }
            }).catch(function (erro) {
                MostrarFeedback("Erro de conexão ao buscar bandas.", false);
            })
        }
        
        function ExibirBandas() {
            var filteredBandList = [];
            var html = '';
            
            var filtro = input__search.value.trim().toLowerCase();
            
            if (filtro != '') {
                for (var i = 0; i < bandList.length; i++) {
                    var nomeBandaMinusculo = bandList[i].name.toLowerCase();
                    if (nomeBandaMinusculo.includes(filtro)) {
                        filteredBandList.push(bandList[i]);
                    }       
                }
            } else {
                filteredBandList = bandList;
            }
            
            
            for (var i = 0; i < filteredBandList.length; i++) {
                html += `
                    <a href="banda.html?id=${filteredBandList[i].id}">
                        <div class="band__box" style="background-image: url('${filteredBandList[i].cover_path}')">
                            <div class="band__name"><h3>${filteredBandList[i].name}</h3></div>
                        </div>
                    </a>
                `
            }
            
            band__list.innerHTML = html;
        }
    </script>
    
    <div id="modal-global" style="display: none;"></div>
</body>
</html>