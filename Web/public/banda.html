<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="css/estilo.css"/>
    <link rel="stylesheet" href="css/banda.css"/>
    <title>Document</title>
</head>
<body>
    <header>
        <nav>
            <a href="index.html" class="header__logo"> <h2>SEMPITERNAL</h2> </a>
            <ul class="header__nav logado">
                <li><a href="index.html" class="navbar__items__options">Home</a></li>
                <li><a href="navigation.html" class="navbar__items__options">Bandas</a></li>
                <li><a href="profile.html" class="navbar__items__options">Perfil</a></li>
                <li> <button onclick="Logout()">Sair</button> </li>
            </ul>
        </nav>
    </header>
    <main>
        <section class="band__banner" id="banner-placeholder">
            <div class="band__header">
                <div class="band__tags title__icon">
                    <h1 class="band__title" id="band-name-placeholder"></h1>
                    <button>
                        <img src="" alt="Star icon." id="favorite-icon-placeholder">
                    </button>
                </div>
                <div class="band__tags">
                    <span class="tag ranking" id="ranking-placeholder"></span>
                    <span class="tag genre" id="genre-placeholder"></span>
                </div>
            </div>
        </section>
        
        <nav class="band__nav">
            <button class="nav__item" id="about">SOBRE</button>
            <button class="nav__item" id="album">ÁLBUNS</button>
        </nav>
        
        <section class="band__info">
            <h2 class="section__title">HISTÓRIA</h2>
            <p class="band__bio" id="bio-placeholder"></p>
        </section>
        
    </main>
    <footer>
        <div class="footer__container">
            <div class=" footer__identidade">
                <a href="index.html"> <h2 class="footer__logo">SEMPITERNAL</h2> </a>
                <div class="footer__social">
                    <a href="https://www.linkedin.com/in/strilicherk/" class="social__link">
                        <img src="assets/icons/LinkedIn.png" alt="LinkedIn"> 
                        <span>LinkedIn</span>
                    </a>
                    <a href="https://github.com/Strilicherk" class="social__link">
                        <img src="assets/icons/GitHub.png" alt="GitHub"> 
                        <span>GitHub</span>
                    </a>
                </div>
            </div>
            
            <nav class="footer__nav">
                <ul class="footer__items">
                    <li><a href="register.html">Cadastre-se</a></li>
                    <li><a href="login.html">Login</a></li>
                    <li><a href="navigation.html">Bandas</a></li>
                </ul>
            </nav>
            
            <div class="footer__legal">
                <p>Todos os direitos (não) reservados.</p>
                <p>Um projeto de faculdade.</p>
            </div>
        </div>
    </footer>
    
    <script>
        var bandaInfos;
        var bandasRanking;
        
        about.classList.add('active');
        
        window.onload = async function() {
            var idBanda = new URLSearchParams(window.location.search).get('id');
            // idUsuario = sessionStorage.ID_USUARIO;
            var idUsuario = 1;
            
            try {
                var resposta;
                
                resposta = await fetch(`/bandas/buscarRanking`);
                
                if (resposta.ok) {
                    bandasRanking = await resposta.json();
                    console.log(bandasRanking);
                } else {
                    console.log('Erro ao trazer ranking')
                }
                
                resposta = await fetch(`/bandas/buscar/${idBanda}?idUsuario=${idUsuario}`)
                
                if (resposta.ok) {
                    bandaInfos = await resposta.json();
                    console.log(bandaInfos);
                } else {
                    console.log('Erro ao trazer as informações da banda')
                }
                
                PopularCampos();
            } catch (resposta) {
                console.log(`#ERRO: ${resposta}`);
            }
        }
        
        function PopularCampos() {
            document.getElementById('banner-placeholder').style.backgroundImage = `url('${bandaInfos.banner_path}')`;
            document.getElementById('band-name-placeholder').innerText = bandaInfos.band;
            document.getElementById('favorite-icon-placeholder').src = bandaInfos.is_favorite_band ? '../assets/icons/FilledStar.png' : '../assets/icons/EmptyStar.png';
            
            for (var i = 0; i < bandasRanking.length; i++) {
                if (bandasRanking[i].band_id == bandaInfos.band_id) {
                    ranking = i + 1;
                    break;
                }
            }
            
            document.getElementById('ranking-placeholder').innerText = `Ranking #${ranking}`;
            document.getElementById('genre-placeholder').innerText = bandaInfos.genre;
            document.getElementById('bio-placeholder').innerText = bandaInfos.about;
        }
        
        
        
    </script>
</body>
</html>