<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/navigation.css">
    <title>Document</title>
</head>
<body>
    <header>
        <nav>
            <a href="index.html" class="header__logo"> <h2>SEMPITERNAL</h2> </a>
            <div class="header__nav">
                <div class="ranking__banda">
                    <ul class="navbar__items">
                        <li><a href="navigation.html" class="navbar__items__options">Bandas</a></li>
                    </ul>
                </div>
                <div class="login__cadastro">
                    <ul class="navbar__items">
                        <li>
                            <a href="login.html" class="navbar__items__options">LOGIN</a>
                        </li>
                        <li>
                            <a href="register.html" class="navbar__items__options"><span class="botao">CADASTRE-SE</span></a>
                        </li>
                    </ul>
                </div>
            </div>
        </nav>
    </header>
    <main>
        <section class="title__search">
            <div class="title__container">
                <h2>EXPLORE AS BANDAS</h2>
                <p>Navegue por todo o catálogo de bandas do Sempiternal</p>
            </div>
            <div class="input__box">
                <input type="text" id="input__search" placeholder="Buscar banda por nome..." oninput="ListarBandas()">
            </div>
        </section>
        <section id="band__list">
        </section>
    </main>
    <footer>
        <div class="footer__container">
            <div class=" footer__identidade">
                <a href="index.html"> <h2 class="footer__logo">SEMPITERNAL</h2> </a>
                <div class="footer__social">
                    <a href="https://www.linkedin.com/in/strilicherk/" class="social__link">
                        <img src="assets/icons/LinkedIn.png" alt="LinkedIn"> 
                        <span>LinkedIn</span>
                    </a>
                    <a href="https://github.com/Strilicherk" class="social__link">
                        <img src="assets/icons/GitHub.png" alt="GitHub"> 
                        <span>GitHub</span>
                    </a>
                </div>
            </div>
            
            <nav class="footer__nav">
                <ul class="footer__items">
                    <li><a href="register.html">Cadastre-se</a></li>
                    <li><a href="login.html">Login</a></li>
                    <li><a href="profile.html">Perfil</a></li>
                    <li><a href="navigation.html">Bandas</a></li>
                    <li><a href="home.html">Ranking</a></li>
                </ul>
            </nav>
            
            <div class="footer__legal">
                <p>Todos os direitos (não) reservados.</p>
                <p>Um projeto de faculdade.</p>
            </div>
        </div>
    </footer>
    
    <script>
        GetBandas()
        
        
        // De primeira eu fiz de maneira ineficiente, para cara letra que o usuários pressionasse uma requisição seria feita pela API.
        // Agora eu estou trazendo todas as bandas de uma vez, e filtrando no próprio vetor.
        // Isso faz com que seja necessário uma única requisição, evitando lag e custos excessivos.
        var bandList;

        function GetBandas() {
            fetch(`/bandas/buscar`, {
                cache: 'no-store',
                headers: {
                    "Content-Type": "application/json"
                }
            })
            .then(function (resposta) {
                console.log(resposta);
                if (resposta.ok) {
                    resposta.json().then(json => {
                        console.log(json);
                        bandList = json;
                        ListarBandas();
                    });
                } else {
                    console.log("Houve um erro ao tentar listar as bandas");
                    
                    resposta.text().then(texto => {
                        console.error(texto);
                        // MostrarFeedback(texto)
                    });
                }
            }).catch(function (erro) {
                // MostrarFeedback(erro)
                console.log(erro);
            })
        }
        
        function ListarBandas() {
            var filteredBandList = [];
            var html = '';
        

            if (input__search.value.trim() != '') {
                for (var i = 0; i < bandList.length; i++) {
                    if (bandList[i].name.includes(input__search.value.trim())) {
                        filteredBandList.push(bandList[i]);
                    }            
                }
            } else {
                filteredBandList = bandList;
            }

            for (var i = 0; i < filteredBandList.length; i++) {
                html += `
                    <a href="banda.html?id=${filteredBandList[i].id}">
                        <div class="band__box" style="background-image: url('${filteredBandList[i].cover_path}')">
                            <div class="band__name"><h3>${filteredBandList[i].name}</h3></div>
                        </div>
                    </a>
                `
            }
            
            band__list.innerHTML = html;
        }
        
        
    </script>
</body>
</html>